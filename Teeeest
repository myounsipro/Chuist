@Injectable({ providedIn: 'root' })
export class AuthService {

  private _userInfos = signal<OidcUser | undefined>(undefined);
  userInfos = this._userInfos.asReadonly();

  constructor(private OauthOidcService: OauthOidcService) {}

  restoreFromStorage() {
    const stored = localStorage.getItem('userInfo');
    if (stored) {
      this._userInfos.set(JSON.parse(stored));
    }
  }

  reloadUserInfo(): Observable<OidcUser> {
    return this.OauthOidcService.loadUserInfo().pipe(
      tap(userInfo => {
        this._userInfos.set(userInfo);
        localStorage.setItem('userInfo', JSON.stringify(userInfo));
      })
    );
  }

  clearUserInfos() {
    this._userInfos.set(undefined);
    localStorage.removeItem('userInfo');
  }
}









